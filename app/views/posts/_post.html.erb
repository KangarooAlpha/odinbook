<%= turbo_frame_tag dom_id(post) do %>
  <% if context == "post" %>
    <div class="bg-base-100 text-base-content p-6 rounded-xl shadow-lg max-w-3xl mx-auto space-y-6">

      <h2 class="text-4xl font-bold text-center text-secondary drop-shadow break-words">
        <%= post.title %>
      </h2>

      <div class="flex justify-end items-center gap-2 text-sm text-gray-400">
        <%= image_tag post.user.avatar_url_or_default, class: "h-10 w-10 object-cover rounded-full" %>
        <%= link_to "@#{post.user.username}", user_path(post.user), class: "hover:underline", data: { turbo: false } %>
      </div>

      <div class="divider divider-primary"></div>
      <div class="space-y-6">

        <% if @images.present? %>
          <div data-controller="carousel" class="swiper max-w-2xl mx-auto">
            <div class="swiper-wrapper">
              <% @images.each do |img| %>
                <div class="swiper-slide">
                  <%= image_tag url_for(img), class: "rounded-lg shadow-lg w-full object-contain max-h-[500px] mx-auto" %>
                </div>
              <% end %>
            </div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
            <div class="swiper-pagination"></div>
          </div>
        <% end %>

        <% post.contents.each do |content| %>
          <% case content.contentable %>
          <% when VideoContent %>
            <div class="flex justify-center">
              <%= video_tag content.contentable.video, controls: true, class: "rounded-lg shadow max-w-full max-h-[500px]" %>
            </div>
          <% when TextContent %>
            <div class="max-w-2xl mx-auto text-center">
              <p class="text-gray-300 leading-relaxed break-words"><%= content.contentable.body %></p>
            </div>
          <% end %>
        <% end %>

      </div>
      <% if post.user == current_user %>
        <div class="flex justify-end gap-3 pt-4 border-t border-base-content/20">
          <%= link_to "Edit", edit_post_path(post: post, context: "post"), class: "btn btn-sm btn-primary mr-2" %>
          <%= button_to "Delete", post_path(post), method: :delete,
              data: { turbo_confirm: "Are you sure you want to delete this post?", turbo: false },
              class: "btn btn-sm btn-error" %>
        </div>
      <% end %>
    </div>

  <% else %>
    <div class="relative">
      <div class="card bg-base-100 border border-primary shadow-md rounded-xl overflow-hidden max-w-2xl mx-auto">
        <div class="card-body space-y-3">

          <%= link_to post.title, post_path(post), data: { turbo: false },
              class: "text-xl font-semibold text-primary hover:underline" %>
          <% preview = post_preview_image(post) %>
          <% if preview.present? %>
            <%= image_tag url_for(preview), class: "rounded shadow w-full h-40 object-cover" %>
          <% end %>
          <% post.contents.each do |content| %>
            <% if content.contentable.is_a?(TextContent)%>
              <p class="text-gray-400 text-sm line-clamp-3 break-words"><%= content.contentable.body %></p>
            <% end %>
          <% end %>
          <% if post.user == current_user %>
            <div class="card-actions flex justify-end gap-2">
              <%= link_to "Edit", edit_post_path(post, context: "index"), class: "btn btn-sm btn-primary" %>
              <%= button_to "Delete", post_path(post), method: :delete,
                  form: { data: { turbo_confirm: "Are you sure?" } },
                  class: "btn btn-sm btn-error" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
