<%= turbo_frame_tag dom_id(post) do %>
  <% if context == "post" %>
    <div class="bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 p-6 rounded-xl shadow-lg max-w-3xl mx-auto space-y-6">

      <h2 class="text-4xl font-extrabold text-center text-purple-200 drop-shadow break-words">
        <%= post.title %>
      </h2>

      <div class="flex justify-end items-center gap-2 text-sm text-gray-400 dark:text-gray-400">
        <%= image_tag post.user.avatar_url_or_default, class: "h-10 w-10 object-cover rounded-full" %>
        <%= link_to "@#{post.user.username}", user_path(post.user), class: "hover:underline", data: { turbo: false } %>
      </div>

      <hr class="border-gray-700" />

      <div class="space-y-6">

        <% if @images.present? %>
          <div data-controller="carousel" class="swiper max-w-2xl mx-auto">
            <div class="swiper-wrapper">
              <% @images.each do |img| %>
                <div class="swiper-slide">
                  <%= image_tag url_for(img), class: "rounded-lg shadow-lg w-full object-contain max-h-[500px] mx-auto" %>
                </div>
              <% end %>
            </div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>
            <div class="swiper-pagination"></div>
          </div>
        <% end %>

        <% post.contents.each do |content| %>
          <% case content.contentable %>
          <% when VideoContent %>
            <div class="flex justify-center">
              <%= video_tag content.contentable.video, controls: true, class: "rounded-lg shadow max-w-full max-h-[500px]" %>
            </div>
          <% when TextContent %>
            <div class="max-w-2xl mx-auto text-center">
              <p class="text-gray-600 dark:text-gray-300 leading-relaxed break-words"><%= content.contentable.body %></p>
            </div>
          <% end %>
        <% end %>

      </div>

      <% if post.user == current_user %>
        <div class="flex justify-end gap-3 pt-4 border-t border-gray-300 dark:border-gray-700">
          <%= link_to "Edit", edit_post_path(post: post, context: "post"), class: "text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 
                  hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 
                  dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2 text-center 
                  hover:cursor-pointer transition transform hover:scale-[1.02] hover:shadow-xl duration-300 ease-in-out" %>
          <%= button_to "Delete", post_path(post), method: :delete,
              data: { turbo_confirm: "Are you sure you want to delete this post?", turbo: false },
              class: "text-white bg-gradient-to-r hover:cursor-pointer from-red-500 via-red-500
                   to-red-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 
                   dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2 text-center
                   transition transform hover:scale-[1.02] hover:shadow-xl duration-300 ease-in-out" %>
        </div>
      <% end %>

    </div>

  <% else %>
    <div class="max-w-full mx-auto">
      <div class="block max-w-auto p-6 bg-white rounded-lg dark:bg-gray-800 dark:border-gray-700">
        <div class="p-5 space-y-3">

          <%= link_to post.title, post_path(post), data: { turbo: false },
              class: "text-xl font-semibold text-purple-200 hover:underline" %>

          <% preview = post_preview_image(post) %>
          <% if preview.present? %>
            <%= image_tag url_for(preview), class: "rounded shadow w-full h-40 object-cover" %>
          <% end %>

          <% post.contents.each do |content| %>
            <% if content.contentable.is_a?(TextContent) %>
              <p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-3 break-words"><%= content.contentable.body %></p>
            <% end %>
          <% end %>

          <% if post.user == current_user %>
            <div class="flex justify-end gap-2 pt-2">
              <%= link_to "Edit", edit_post_path(post, context: "index"),
                  class: "text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 
                  hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 
                  dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2 text-center 
                  hover:cursor-pointer transition transform hover:scale-[1.02] hover:shadow-xl duration-300 ease-in-out" %>
              <%= button_to "Delete", post_path(post), method: :delete,
                  data: { turbo_confirm: "Are you sure?" },
                  class: "text-white bg-gradient-to-r hover:cursor-pointer from-red-500 via-red-500
                   to-red-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 
                   dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2 text-center
                   transition transform hover:scale-[1.02] hover:shadow-xl duration-300 ease-in-out" %>
            </div>
          <% end %>

        </div>
      </div>
    </div>
  <% end %>
<% end %>
